* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  color: #272B34;
  background: url('/mathmonsters/images/background/background.png') no-repeat center/cover;
  position: relative;
  overflow: hidden;
}

main.landing {
  position: relative;
  width: 100%;
  min-height: 100vh;
  opacity: 1;
  transform: translate3d(0, 0, 0);
  filter: none;
  transition: opacity 0.6s ease, transform 0.6s ease, filter 0.6s ease;
  will-change: opacity, transform, filter;
}

body.is-preloading {
  overflow: hidden;
}

body.is-preloading main.landing {
  opacity: 0;
  transform: translate3d(0, 24px, 0) scale(0.98);
  filter: blur(6px);
  pointer-events: none;
}

body:not(.is-preloading) main.landing {
  opacity: 1;
  transform: translate3d(0, 0, 0) scale(1);
  filter: none;
}

@media (prefers-reduced-motion: reduce) {
  main.landing {
    transition: none;
  }

  body.is-preloading main.landing {
    transform: none;
    filter: none;
  }
}

.hero {
  position: absolute;
  bottom: 32vh;
  left: 50%;
  max-width: 300px;
  max-height: 300px;
  transform: translate(-50%, 0);
  animation: hero-float 3.5s ease-in-out infinite;
  image-rendering: auto;
  z-index: 2;
  pointer-events: none;
}

@keyframes hero-float {
  0%   { transform: translate(-50%, 0) translateY(0); }
  50%  { transform: translate(-50%, 0) translateY(-32px); }
  100% { transform: translate(-50%, 0) translateY(0); }
}

/* Bubble field */
.bubbles {
  position: absolute;
  left: 50%;
  bottom: 0;
  transform: translateX(-50%);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  gap: clamp(24px, 8vw, 72px);
  width: min(720px, 100%);
  padding: 0 16px clamp(120px, 22vh, 200px);
  overflow: visible;
  pointer-events: none;
  z-index: 1;
}

/* ---- Realistic bubbles ----
   Using animatable custom properties so multiple animations can
   combine without fighting over 'transform'.
*/
@property --tx { syntax: '<length>'; initial-value: 0px; inherits: false; }
@property --ty { syntax: '<length>'; initial-value: 0px; inherits: false; }
@property --sx { syntax: '<number>'; initial-value: 1;   inherits: false; }
@property --sy { syntax: '<number>'; initial-value: 1;   inherits: false; }
@property --rot { syntax: '<angle>';  initial-value: 0deg; inherits: false; }

/* SUPER-realistic, clear “water glass” bubbles */
.bubble {
  --drift: 0px;
  position: relative;
  bottom: -80px;
  flex: 0 0 auto;
  width: var(--size);
  height: var(--size);
  border-radius: 50%;
  opacity: 0;

  /* Base: faint tint so it reads against any BG */
  background: radial-gradient(circle at 50% 45%,
    rgba(255,255,255,0.10) 0%,
    rgba(255,255,255,0.05) 40%,
    rgba(255,255,255,0.02) 65%,
    rgba(255,255,255,0.00) 100%);

  /* Subtle inner/outside glow for depth */
  box-shadow:
    inset 0 0 10px rgba(255,255,255,0.18),
    0 2px 12px rgba(120,170,220,0.12);

  /* Transform pipeline driven by variables (kept from your version) */
  transform: translate3d(var(--tx), var(--ty), 0) rotate(var(--rot)) scale(var(--sx), var(--sy));
  will-change: transform, opacity;

  animation:
    bubble-rise var(--duration) cubic-bezier(.22,.61,.36,1) infinite,
    bubble-drift calc(var(--duration) * 0.45) ease-in-out infinite alternate,
    bubble-wobble calc(var(--duration) * 0.38) ease-in-out infinite,
    bubble-spin   calc(var(--duration) * 0.9)  ease-in-out infinite alternate;
  animation-delay:
    var(--delay, 0s),
    var(--delay, 0s),
    var(--delay, 0s),
    var(--delay, 0s);

  /* Let highlights lift color beneath (gives glass pop) */
  mix-blend-mode: screen; /* harmless if BG is light; looks great on dark/colored scenes */
}

/* High-end refraction: only if supported (graceful fallback above) */
@supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
  .bubble {
    /* Clear glass feel: blur/saturate/brighten background seen through bubble */
    background: rgba(255,255,255,0.04); /* nearly clear */
    -webkit-backdrop-filter: blur(6px) saturate(130%) brightness(1.06);
            backdrop-filter: blur(6px) saturate(130%) brightness(1.06);
  }
}

/* RIM: crisp thin edge using a mask so center stays clear */
.bubble::before,
.bubble::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 50%;
  pointer-events: none;
}

/* Thin luminous rim + micro-rainbow sheen */
.bubble::before {
  /* ring drawn by mask; shows only the outer band */
  background:
    conic-gradient(from 210deg,
      rgba(255,255,255,0.35) 0deg,
      rgba(255,255,255,0.18) 120deg,
      rgba(200,230,255,0.20) 180deg,
      rgba(255,255,255,0.28) 270deg,
      rgba(255,255,255,0.35) 360deg);
  -webkit-mask: radial-gradient(closest-side,
      transparent calc(100% - 2.5px), /* ring thickness */
      #000 calc(100% - 2.0px));
          mask: radial-gradient(closest-side,
      transparent calc(100% - 2.5px),
      #000 calc(100% - 2.0px));
  filter: blur(0.6px);         /* soften rim a hair */
  opacity: 0.9;
  mix-blend-mode: screen;
}

/* SPECULAR HIGHLIGHTS: small bright dot + soft lens inside */
.bubble::after {
  /* two-layer highlight packed into one pseudo for perf */
  background:
    radial-gradient(20% 20% at 30% 28%, rgba(255,255,255,0.88) 0%, rgba(255,255,255,0.0) 100%),
    radial-gradient(60% 50% at 55% 45%, rgba(255,255,255,0.20) 0%, rgba(255,255,255,0.06) 60%, rgba(255,255,255,0.0) 100%);
  filter: blur(2.2px);
  opacity: 0.85;
  mix-blend-mode: screen;
}

/* Keep your gentle drift bias without time staggering */
.bubble:nth-of-type(odd) { --drift: 12px; }
.bubble:nth-of-type(3n)  { --drift: -10px; }


/* Rise: non-linear opacity + slight pressure expansion as it ascends */
@keyframes bubble-rise {
  0%   { --ty: 0px;                 --sx: 0.95; --sy: 0.95; opacity: 0; }
  10%  {                            --sx: 0.98; --sy: 0.98; opacity: 0.45; }
  40%  {                            --sx: 1.02; --sy: 1.02; opacity: 0.92; }
  100% { --ty: -110vh;              --sx: 1.06; --sy: 1.06; opacity: 0; }
}

.splat-overlay {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(10, 61, 98, 0.92);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity 0.35s ease;
  z-index: 12;
}

.splat-overlay.is-active {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

.splat-overlay__letters {
  display: flex;
  gap: clamp(12px, 3vw, 32px);
  font-family: var(--font-heading, 'Baloo 2', system-ui, sans-serif);
  font-size: clamp(56px, 18vw, 164px);
  letter-spacing: clamp(4px, 1vw, 12px);
  color: #ffffff;
  text-transform: uppercase;
}

.splat-letter {
  display: inline-block;
  opacity: 0;
  transform: translateY(32px) scale(0.6);
  animation: splat-letter-pop 0.6s cubic-bezier(0.25, 0.9, 0.35, 1.4) forwards;
  animation-delay: calc(var(--index, 0) * 0.12s);
  animation-play-state: paused;
}

.splat-overlay.is-active .splat-letter {
  animation-play-state: running;
}

@keyframes splat-letter-pop {
  0% {
    opacity: 0;
    transform: translateY(32px) scale(0.6);
  }
  60% {
    opacity: 1;
    transform: translateY(-8px) scale(1.12);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@media (prefers-reduced-motion: reduce) {
  .splat-overlay {
    transition: none;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
  }

  .splat-letter {
    animation: none;
    opacity: 1;
    transform: none;
  }
}

/* Organic horizontal meander tied to --drift */
@keyframes bubble-drift {
  0%   { --tx: calc(var(--drift) * -1); }
  100% { --tx: calc(var(--drift)); }
}

/* Water wobble: subtle squash & stretch out of phase */
@keyframes bubble-wobble {
  0%   { --sx: calc(var(--sx));   --sy: calc(var(--sy)); }
  25%  { --sx: calc(var(--sx) * 0.985); --sy: calc(var(--sy) * 1.015); }
  50%  { --sx: calc(var(--sx) * 1.01);  --sy: calc(var(--sy) * 0.99); }
  75%  { --sx: calc(var(--sx) * 0.99);  --sy: calc(var(--sy) * 1.01); }
  100% { --sx: calc(var(--sx));   --sy: calc(var(--sy)); }
}

/* Tiny spin for parallax sparkle */
@keyframes bubble-spin {
  0%   { --rot: -2deg; }
  100% { --rot: 3deg; }
}

/* ------------------------------------------------------------------------- */
/* Simple preload experience ---------------------------------------------- */

.preloader {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 24px;
  padding: 32px;
  background-color: #001b41;
  z-index: 10;
  text-align: center;
  transition: opacity 0.4s ease;
}

.preloader__logo {
  width: 300px;
  height: 300px;
  object-fit: contain;
}

.preloader__text {
  margin: 0;
  font-size: 32px;
  color: #ffffff;
}

.preloader__spinner {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: 6px solid rgba(255, 255, 255, 0.2);
  border-top-color: #ffffff;
  animation: preloader-spin 1s linear infinite;
}

.preloader--hidden {
  opacity: 0;
  pointer-events: none;
}

@media (prefers-reduced-motion: reduce) {
  .preloader {
    transition: none;
  }

  .preloader__spinner {
    animation-duration: 0s;
  }
}

@keyframes preloader-spin {
  to {
    transform: rotate(360deg);
  }
}


.pwa-install {
  position: relative;
  z-index: 7;
  margin: clamp(16px, 4vw, 32px) auto clamp(40px, 8vh, 96px);
  padding: clamp(16px, 4vw, 32px);
  max-width: min(420px, 90%);
  border-radius: 28px;
  background: rgba(255, 255, 255, 0.92);
  box-shadow: 0 18px 48px rgba(14, 57, 93, 0.25);
  display: flex;
  flex-direction: column;
  gap: 16px;
  text-align: center;
  color: #0a3d62;
  backdrop-filter: blur(6px);
}

@supports not ((backdrop-filter: blur(6px))) {
  .pwa-install {
    background: rgba(255, 255, 255, 0.98);
  }
}

.pwa-install__title {
  margin: 0;
  font-size: clamp(1.25rem, 2vw, 1.6rem);
  letter-spacing: 0.03em;
}

.pwa-install__message {
  margin: 0;
  font-size: clamp(0.95rem, 1.8vw, 1.05rem);
  line-height: 1.5;
  color: rgba(10, 61, 98, 0.85);
}

.pwa-install__actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
}

.pwa-install__button {
  width: min(260px, 100%);
}

.pwa-install__link {
  color: #0a3d62;
  text-decoration: none;
}

.pwa-install__link:hover,
.pwa-install__link:focus {
  text-decoration: underline;
}

@media (min-width: 768px) {
  .pwa-install {
    position: absolute;
    bottom: clamp(32px, 5vh, 72px);
    right: clamp(32px, 6vw, 96px);
    margin: 0;
    text-align: left;
    align-items: flex-start;
  }

  .pwa-install__actions {
    flex-direction: row;
    justify-content: flex-start;
  }

  .pwa-install__link {
    font-size: 0.95rem;
  }
}
