* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  min-height: 100dvh;
  color: #272B34;
  background: url('../images/background/background.png') no-repeat center/cover;
  position: relative;
  overflow: hidden;
}

main.landing {
  position: relative;
  width: 100%;
  min-height: 100vh;
  min-height: 100dvh;
  opacity: 1;
  transform: translate3d(0, 0, 0);
  filter: none;
  transition: opacity 0.6s ease, transform 0.6s ease, filter 0.6s ease;
  will-change: opacity, transform, filter;
}

main.landing.is-battle-transition {
  animation: landing-battle-shift 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

body.is-preloading {
  overflow: hidden;
}

body.is-preloading main.landing {
  opacity: 0;
  transform: translate3d(0, 24px, 0) scale(0.98);
  filter: blur(6px);
  pointer-events: none;
}

body:not(.is-preloading) main.landing {
  opacity: 1;
  transform: translate3d(0, 0, 0) scale(1);
  filter: none;
}

@media (prefers-reduced-motion: reduce) {
  main.landing {
    transition: none;
  }

  body.is-preloading main.landing {
    transform: none;
    filter: none;
  }
}

.battle-cast {
  --battle-cast-hero-shift: clamp(120px, 18vw, 260px);
  position: relative;
  width: 100%;
  min-height: inherit;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: clamp(32px, 8vh, 96px) clamp(24px, 8vw, 96px);
  pointer-events: none;
  z-index: 2;
}

.battle-cast__hero,
.battle-cast__enemy {
  position: absolute;
  top: 52%;
  transform: translate3d(-50%, -50%, 0);
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
}

.battle-cast__hero {
  left: 50%;
  transition: transform 0.9s cubic-bezier(0.16, 1, 0.3, 1);
  will-change: transform;
  z-index: 3;
}

.battle-cast.is-enemy-present .battle-cast__hero {
  transform: translate3d(calc(-50% - var(--battle-cast-hero-shift)), -50%, 0);
}

.battle-cast__enemy {
  right: clamp(20px, 10vw, 200px);
  transform: translate3d(140%, -50%, 0);
  transition: transform 0.9s cubic-bezier(0.16, 1, 0.3, 1);
  will-change: transform;
  z-index: 2;
}

.battle-cast__enemy.is-visible {
  transform: translate3d(0, -50%, 0);
}

.hero,
.enemy {
  width: min(320px, 42vw);
  max-width: 320px;
  height: auto;
  image-rendering: auto;
}

.hero {
  --hero-direction: -1;
  --hero-float-range: 32px;
  --hero-float-duration: 3.5s;
  animation: hero-float var(--hero-float-duration, 3.5s) ease-in-out 1.35s infinite;
  transform: translate3d(0, calc(-1 * var(--hero-float-range, 32px)), 0)
    scaleX(var(--hero-direction, 1))
    scale(1);
  transform-origin: 50% 90%;
  pointer-events: none;
  will-change: transform, opacity;
  z-index: 3;
}

.battle-cast.is-enemy-present .hero {
  --hero-direction: 1;
}

.hero.is-battle-transition {
  animation: hero-battle-exit 0.65s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

.enemy {
  --enemy-direction: -1;
  opacity: 0;
  transform: scaleX(var(--enemy-direction, 1)) scale(0.92);
  transform-origin: 50% 90%;
  pointer-events: none;
  will-change: transform, opacity;
  filter: drop-shadow(0 18px 24px rgba(0, 0, 0, 0.25));
  transition: opacity 0.45s ease, transform 0.45s ease;
}

.enemy.is-visible {
  opacity: 1;
  transform: scaleX(var(--enemy-direction, 1)) scale(1);
}

.enemy.is-battle-transition {
  animation: enemy-battle-exit 0.65s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

.battle-time {
  position: absolute;
  left: 50%;
  top: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: min(320px, 68vw);
  max-width: min(420px, 72vw);
  padding: clamp(16px, 4vw, 32px) clamp(36px, 8vw, 72px);
  border-radius: 999px;
  border: 4px solid rgba(255, 255, 255, 0.85);
  background:
    radial-gradient(120% 120% at 50% 10%, rgba(255, 255, 255, 0.65), transparent 70%),
    linear-gradient(160deg, #ffe169 10%, #ff9f1c 55%, #ff5d8f 100%);
  color: #14223f;
  font-size: clamp(2rem, 6vw, 3.8rem);
  font-weight: 800;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  text-align: center;
  line-height: 1;
  white-space: nowrap;
  text-shadow: 0 4px 0 rgba(255, 255, 255, 0.6), 0 8px 24px rgba(0, 0, 0, 0.35);
  box-shadow:
    0 12px 28px rgba(0, 0, 0, 0.35),
    inset 0 -6px 0 rgba(0, 0, 0, 0.15);
  transform: translate(-50%, -50%) scale(0.6);
  opacity: 0;
  font-family: var(--font-family-rounded);
  user-select: none;
  pointer-events: none;
  will-change: transform, opacity;
  z-index: 5;
}

.battle-time.is-visible {
  animation: battle-time-pop 0.55s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.battle-time.is-battle-transition {
  animation: battle-time-exit 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

@media (max-width: 640px) {
  .battle-cast {
    --battle-cast-hero-shift: clamp(80px, 28vw, 160px);
  }

  .battle-cast__enemy {
    right: clamp(12px, 18vw, 140px);
  }

  .battle-time {
    min-width: min(260px, 70vw);
    padding: clamp(12px, 3.5vw, 24px) clamp(28px, 7vw, 52px);
    font-size: clamp(1.8rem, 8vw, 3.2rem);
  }
}

@keyframes hero-float {
  0% {
    transform: translate3d(0, calc(-1 * var(--hero-float-range, 32px)), 0)
      scaleX(var(--hero-direction, 1))
      scale(1);
  }
  50% {
    transform: translate3d(0, var(--hero-float-range, 32px), 0)
      scaleX(var(--hero-direction, 1))
      scale(1);
  }
  100% {
    transform: translate3d(0, calc(-1 * var(--hero-float-range, 32px)), 0)
      scaleX(var(--hero-direction, 1))
      scale(1);
  }
}

@keyframes hero-battle-exit {
  0% {
    transform: translate3d(0, calc(-1 * var(--hero-float-range, 32px)), 0)
      scaleX(var(--hero-direction, 1))
      scale(1);
    opacity: 1;
  }
  50% {
    transform: translate3d(0, calc(-1 * var(--hero-float-range, 32px)), 0)
      scaleX(var(--hero-direction, 1))
      scale(1.08);
    opacity: 1;
  }
  60% {
    transform: translate3d(0, calc(-1 * var(--hero-float-range, 32px)), 0)
      scaleX(var(--hero-direction, 1))
      scale(1.05);
    opacity: 0.96;
  }
  100% {
    transform: translate3d(0, calc(-1 * var(--hero-float-range, 32px)), 0)
      scaleX(var(--hero-direction, 1))
      scale(0.62);
    opacity: 0;
  }
}

@keyframes enemy-battle-exit {
  0% {
    transform: scaleX(var(--enemy-direction, 1)) scale(1);
    opacity: 1;
  }
  50% {
    transform: scaleX(var(--enemy-direction, 1)) scale(1.08);
    opacity: 1;
  }
  60% {
    transform: scaleX(var(--enemy-direction, 1)) scale(1.05);
    opacity: 0.96;
  }
  100% {
    transform: scaleX(var(--enemy-direction, 1)) scale(0.62);
    opacity: 0;
  }
}

@keyframes battle-time-pop {
  0% {
    transform: translate(-50%, -50%) scale(0.6);
    opacity: 0;
  }
  60% {
    transform: translate(-50%, -50%) scale(1.05);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }
}

@keyframes battle-time-exit {
  0% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(0.5);
    opacity: 0;
  }
}

@media (prefers-reduced-motion: reduce) {
  .battle-cast__hero,
  .battle-cast__enemy {
    transition: none;
  }

  .battle-cast__enemy,
  .battle-cast__enemy.is-visible {
    transform: translate3d(0, -50%, 0);
  }

  .hero {
    animation: none;
    transform: scaleX(var(--hero-direction, 1)) scale(1);
  }

  .hero.is-battle-transition,
  .enemy.is-battle-transition,
  .battle-time.is-battle-transition {
    animation: none;
    opacity: 0;
  }

  .enemy {
    transition: none;
    opacity: 1;
    transform: scaleX(var(--enemy-direction, 1)) scale(1);
  }

  .battle-time {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }

  .battle-time.is-visible {
    animation: none;
  }
}
@keyframes landing-battle-shift {
  0% {
    transform: translate3d(0, 0, 0) scale(1);
    filter: none;
  }
  36% {
    transform: translate3d(0, -6px, 0) scale(1.01);
    filter: saturate(1.05) brightness(1.02);
  }
  100% {
    transform: translate3d(0, -14px, 0) scale(1.03);
    filter: saturate(1.12) brightness(1.05);
  }
}

@keyframes bubble-field-fade {
  0% {
    transform: translate3d(-50%, 0, 0);
    opacity: 1;
  }
  100% {
    transform: translate3d(-50%, 18px, 0);
    opacity: 0;
  }
}

.card--home.is-battle-transition {
  will-change: transform, opacity;
  animation: card-pop-out 0.58s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

@keyframes card-pop-out {
  0% {
    transform: translate3d(
        var(--card-translate-x, -50%),
        var(--card-translate-y, 0),
        var(--card-translate-z, 0)
      )
      scale(1);
    opacity: 1;
  }
  25% {
    transform: translate3d(
        var(--card-translate-x, -50%),
        var(--card-translate-y, 0),
        var(--card-translate-z, 0)
      )
      scale(0.95);
    opacity: 1;
  }
  58% {
    transform: translate3d(
        var(--card-translate-x, -50%),
        var(--card-translate-y, 0),
        var(--card-translate-z, 0)
      )
      scale(1.07);
    opacity: 1;
  }
  100% {
    transform: translate3d(
        var(--card-translate-x, -50%),
        var(--card-translate-y, 0),
        var(--card-translate-z, 0)
      )
      scale(0.83);
    opacity: 0;
  }
}

@media (prefers-reduced-motion: reduce) {
  .card--home.is-battle-transition {
    opacity: 0;
  }
}

/* Bubble field */
.bubbles {
  position: absolute;
  left: 50%;
  bottom: 0;
  transform: translateX(-50%);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  gap: clamp(24px, 8vw, 72px);
  width: min(720px, 100%);
  padding: 0 16px
    calc(
      clamp(120px, 22vh, 200px) +
      var(--viewport-bottom-offset, 0px)
    );
  padding: 0 16px
    calc(
      clamp(120px, 22vh, 200px) +
      var(--viewport-bottom-offset, 0px) +
      constant(safe-area-inset-bottom)
    );
  padding: 0 16px
    calc(
      clamp(120px, 22vh, 200px) +
      var(--viewport-bottom-offset, 0px) +
      env(safe-area-inset-bottom, 0px)
    );
  overflow: visible;
  pointer-events: none;
  z-index: 1;
  will-change: transform, opacity;
}

.bubbles.is-battle-transition {
  animation: bubble-field-fade 0.5s ease forwards;
}

/* ---- Realistic bubbles ----
   Using animatable custom properties so multiple animations can
   combine without fighting over 'transform'.
*/
@property --tx { syntax: '<length>'; initial-value: 0px; inherits: false; }
@property --ty { syntax: '<length>'; initial-value: 0px; inherits: false; }
@property --sx { syntax: '<number>'; initial-value: 1;   inherits: false; }
@property --sy { syntax: '<number>'; initial-value: 1;   inherits: false; }
@property --rot { syntax: '<angle>';  initial-value: 0deg; inherits: false; }

/* SUPER-realistic, clear “water glass” bubbles */
.bubble {
  --drift: 0px;
  position: relative;
  bottom: -80px;
  flex: 0 0 auto;
  width: var(--size);
  height: var(--size);
  border-radius: 50%;
  opacity: 0;

  /* Base: faint tint so it reads against any BG */
  background: radial-gradient(circle at 50% 45%,
    rgba(255,255,255,0.10) 0%,
    rgba(255,255,255,0.05) 40%,
    rgba(255,255,255,0.02) 65%,
    rgba(255,255,255,0.00) 100%);

  /* Subtle inner/outside glow for depth */
  box-shadow:
    inset 0 0 10px rgba(255,255,255,0.18),
    0 2px 12px rgba(120,170,220,0.12);

  /* Transform pipeline driven by variables (kept from your version) */
  transform: translate3d(var(--tx), var(--ty), 0) rotate(var(--rot)) scale(var(--sx), var(--sy));
  will-change: transform, opacity;

  animation:
    bubble-rise var(--duration) cubic-bezier(.22,.61,.36,1) infinite,
    bubble-drift calc(var(--duration) * 0.45) ease-in-out infinite alternate,
    bubble-wobble calc(var(--duration) * 0.38) ease-in-out infinite,
    bubble-spin   calc(var(--duration) * 0.9)  ease-in-out infinite alternate;
  animation-delay:
    var(--delay, 0s),
    var(--delay, 0s),
    var(--delay, 0s),
    var(--delay, 0s);

  /* Let highlights lift color beneath (gives glass pop) */
  mix-blend-mode: screen; /* harmless if BG is light; looks great on dark/colored scenes */
}

/* High-end refraction: only if supported (graceful fallback above) */
@supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
  .bubble {
    /* Clear glass feel: blur/saturate/brighten background seen through bubble */
    background: rgba(255,255,255,0.04); /* nearly clear */
    -webkit-backdrop-filter: blur(6px) saturate(130%) brightness(1.06);
            backdrop-filter: blur(6px) saturate(130%) brightness(1.06);
  }
}

/* RIM: crisp thin edge using a mask so center stays clear */
.bubble::before,
.bubble::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 50%;
  pointer-events: none;
}

/* Thin luminous rim + micro-rainbow sheen */
.bubble::before {
  /* ring drawn by mask; shows only the outer band */
  background:
    conic-gradient(from 210deg,
      rgba(255,255,255,0.35) 0deg,
      rgba(255,255,255,0.18) 120deg,
      rgba(200,230,255,0.20) 180deg,
      rgba(255,255,255,0.28) 270deg,
      rgba(255,255,255,0.35) 360deg);
  -webkit-mask: radial-gradient(closest-side,
      transparent calc(100% - 2.5px), /* ring thickness */
      #000 calc(100% - 2.0px));
          mask: radial-gradient(closest-side,
      transparent calc(100% - 2.5px),
      #000 calc(100% - 2.0px));
  filter: blur(0.6px);         /* soften rim a hair */
  opacity: 0.9;
  mix-blend-mode: screen;
}

/* SPECULAR HIGHLIGHTS: small bright dot + soft lens inside */
.bubble::after {
  /* two-layer highlight packed into one pseudo for perf */
  background:
    radial-gradient(20% 20% at 30% 28%, rgba(255,255,255,0.88) 0%, rgba(255,255,255,0.0) 100%),
    radial-gradient(60% 50% at 55% 45%, rgba(255,255,255,0.20) 0%, rgba(255,255,255,0.06) 60%, rgba(255,255,255,0.0) 100%);
  filter: blur(2.2px);
  opacity: 0.85;
  mix-blend-mode: screen;
}

/* Keep your gentle drift bias without time staggering */
.bubble:nth-of-type(odd) { --drift: 12px; }
.bubble:nth-of-type(3n)  { --drift: -10px; }


/* Rise: non-linear opacity + slight pressure expansion as it ascends */
@keyframes bubble-rise {
  0%   { --ty: 0px;                 --sx: 0.95; --sy: 0.95; opacity: 0; }
  10%  {                            --sx: 0.98; --sy: 0.98; opacity: 0.45; }
  40%  {                            --sx: 1.02; --sy: 1.02; opacity: 0.92; }
  100% { --ty: -110vh;              --sx: 1.06; --sy: 1.06; opacity: 0; }
}


/* Organic horizontal meander tied to --drift */
@keyframes bubble-drift {
  0%   { --tx: calc(var(--drift) * -1); }
  100% { --tx: calc(var(--drift)); }
}

/* Water wobble: subtle squash & stretch out of phase */
@keyframes bubble-wobble {
  0%   { --sx: calc(var(--sx));   --sy: calc(var(--sy)); }
  25%  { --sx: calc(var(--sx) * 0.985); --sy: calc(var(--sy) * 1.015); }
  50%  { --sx: calc(var(--sx) * 1.01);  --sy: calc(var(--sy) * 0.99); }
  75%  { --sx: calc(var(--sx) * 0.99);  --sy: calc(var(--sy) * 1.01); }
  100% { --sx: calc(var(--sx));   --sy: calc(var(--sy)); }
}

/* Tiny spin for parallax sparkle */
@keyframes bubble-spin {
  0%   { --rot: -2deg; }
  100% { --rot: 3deg; }
}

/* ------------------------------------------------------------------------- */
/* Simple preload experience ---------------------------------------------- */

.preloader {
  --app-safe-area-padding: clamp(24px, 6vw, 48px);
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 24px;
  background-color: #001b41;
  z-index: 10;
  text-align: center;
  transition: opacity 0.4s ease;
  padding-top: calc(
    var(--app-safe-area-padding) + env(safe-area-inset-top, 0px)
  );
  padding-bottom: calc(
    var(--app-safe-area-padding) + env(safe-area-inset-bottom, 0px)
  );
  padding-left: calc(
    var(--app-safe-area-padding) + env(safe-area-inset-left, 0px)
  );
  padding-right: calc(
    var(--app-safe-area-padding) + env(safe-area-inset-right, 0px)
  );
  box-sizing: border-box;
}

.preloader__logo {
  width: min(200px, 45vw);
  height: min(200px, 45vw);
  max-width: 200px;
  max-height: 200px;
  object-fit: contain;
}

.preloader__text {
  margin: 0;
  font-size: var(--text-size-large);
  color: var(--text-color-light);
}

.preloader__spinner {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: 6px solid rgba(255, 255, 255, 0.2);
  border-top-color: #ffffff;
  animation: preloader-spin 1s linear infinite;
}

.preloader--hidden {
  opacity: 0;
  pointer-events: none;
}

@media (prefers-reduced-motion: reduce) {
  .preloader {
    transition: none;
  }

  .preloader__spinner {
    animation-duration: 0s;
  }
}

@keyframes preloader-spin {
  to {
    transform: rotate(360deg);
  }
}


.pwa-install {
  position: relative;
  z-index: 7;
  margin: clamp(16px, 4vw, 32px)
    auto
    calc(clamp(40px, 8vh, 96px) + env(safe-area-inset-bottom, 0px));
  padding: clamp(16px, 4vw, 32px);
  max-width: min(420px, 90%);
  border-radius: 28px;
  background: rgba(255, 255, 255, 0.92);
  box-shadow: 0 18px 48px rgba(14, 57, 93, 0.25);
  display: flex;
  flex-direction: column;
  gap: 16px;
  text-align: center;
  color: #0a3d62;
  backdrop-filter: blur(6px);
}

@supports not ((backdrop-filter: blur(6px))) {
  .pwa-install {
    background: rgba(255, 255, 255, 0.98);
  }
}

.pwa-install__title {
  margin: 0;
  font-size: clamp(1.25rem, 2vw, 1.6rem);
  letter-spacing: 0.03em;
}

.pwa-install__message {
  margin: 0;
  font-size: clamp(0.95rem, 1.8vw, 1.05rem);
  line-height: 1.5;
  color: rgba(10, 61, 98, 0.85);
}

.pwa-install__actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
}

.pwa-install__button {
  width: min(260px, 100%);
}

.pwa-install__link {
  color: #0a3d62;
  text-decoration: none;
}

.pwa-install__link:hover,
.pwa-install__link:focus {
  text-decoration: underline;
}

@media (min-width: 768px) {
  .pwa-install {
    position: absolute;
    bottom: calc(clamp(32px, 5vh, 72px) + env(safe-area-inset-bottom, 0px));
    right: clamp(32px, 6vw, 96px);
    margin: 0;
    text-align: left;
    align-items: flex-start;
  }

  .pwa-install__actions {
    flex-direction: row;
    justify-content: flex-start;
  }

  .pwa-install__link {
    font-size: 0.95rem;
  }
}
